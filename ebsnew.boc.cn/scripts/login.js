/*! BUILD: 2016-04-22 */
$(function(){"use strict";function a(a){function b(){f+=1,f===e&&a&&a()}function c(a,b){return Common[a]&&Common[a][lan]?Common[a][lan][b]||"":""}var d=[{name:"externUrl_zh_CN",map:"urls",lan:"C"},{name:"externUrl_en_US",map:"urls",lan:"E"}],e=d.length,f=0;Common.urls={},CU.getUrl=function(a){return $.trim(c("urls",a))},$.each(d,function(a,c){$.ajax({url:"config/"+c.name+".json?v="+window.VERSION,type:"get"}).then(function(a){Common[c.map][c.lan]=a,b()})})}function b(a){a&&Common.postRequest(new Model("PSNCreatConversation")).then(function(b){a(CU.ajaxDataHandle(b))})}function c(a,b){Common.postRequest(new Model("PSNCloseConversation",a)).then(function(){b&&b()})}function d(){1==t&&$("#captcha_debitCard").attr("src",validationURL+(new Date).getTime()+".gif"),2==t&&$("#captcha_creditCard").attr("src",validationURL+(new Date).getTime()+".gif"),0==t&&$("#captcha").attr("src",validationURL+(new Date).getTime()+".gif"),$.browser.msie?($("#txt_captcha_79449").val(CU.getDictNameByKey("l7143")),$("#txt_captcha_740885").val(CU.getDictNameByKey("l7143")),$("#txt_captcha_741012").val(CU.getDictNameByKey("l7143"))):($("#txt_captcha_79449").val(""),$("#txt_captcha_740885").val(""),$("#txt_captcha_741012").val(""))}function e(a){Common.postRequest(new Model("PSNCreatConversationLoginPre")).then(function(b){i=CU.ajaxDataHandle(b),a||Common.postRequest(new Model("PsnCommonQueryOprIpforlogin")).then(function(a){ProxyCollector.externalIP=CU.ajaxDataHandle(a),ProxyCollector.initProxyCollection()}),Common.postRequest(new Model("PSNGetRandomLoginPre",i)).then(function(a){j=CU.ajaxDataHandle(a),CU.isSuccesful(a)&&($("#div_password_79445").sec({mode:10,RandomKey_S:j}),$("#div_password_79445").sec("Version")||($("#sec_container").hide(),$("#sec_required").show())),d()})})}function f(){Common.LightBox.show(),Common.postRequest(new Model("PsnAccBocnetCreateConversationPre")).then(function(a){q=CU.ajaxDataHandle(a),Common.postRequest(new Model("PsnAccBocnetGetRandomPre",q)).then(function(a){r=CU.ajaxDataHandle(a),g($("#txt_username_79443"))})})}function g(a){$("#misMatchAcctPop").remove();var b=$(a).val(),c=b.length;!/^[0-9]*$/.test(b)||15!=c&&16!=c&&19!=c?(t=0,$("#txt_username_79443").val(b),Common.LightBox.hide(),$("#cardLogin_ul").hide(),$("#cardLogin_ul").prev().show()):((!u||v)&&Common.LightBox.show(),Common.postRequest(new Model("PsnAccBocnetQryCardType",{accountNumber:b})).then(function(a){if(CU.ajaxDataHandle(a),Common.LightBox.hide(),CU.isSuccesful(a)){var c=CU.ajaxDataHandle(a);c.accountType&&"119"==c.accountType?(Common.isDebitCard=!0,t=1,$("#cardLogin_ul").prev().hide(),$("#cardLogin_ul").html(s.debitCardLogin,function(){CU.changeLan($("#cardLogin_ul")),Common.LightBox.hide(),$("#txt_50514_741010").on("blur",function(){/^[0-9]*$/.test($(this).val())||15==$(this).val().length&&16==$(this).val().length&&19==$(this).val().length?(/^[0-9]*$/.test($(this).val())&&(15==$(this).val().length||16==$(this).val().length)||19!=$(this).val().length)&&(v=!0,g($(this))):($("#cardLogin_ul").hide(),$("#cardLogin_ul").prev().show(),$("#txt_username_79443").val($(this).val()))}),$("#txt_50514_741010").val(b),$("#div_password_79445_1").sec({mode:3,RandomKey_S:r}),$("#div_password_79445_1").sec("Version")||($("#sec_container").hide(),$("#sec_required").show()),$("#captcha_debitCard").attr("src",validationURL+(new Date).getTime()+".gif"),$("#txt_captcha_741012").val($.browser.msie?CU.getDictNameByKey($("#txt_captcha_741012").attr("phLan")):""),$("#a_shuaxin_741013,#captcha_debitCard").on("click",function(a){stopBubble(a||window.event),setTimeout(function(){$("#captcha_debitCard").attr("src",validationURL+(new Date).getTime()+".gif")},1)}),$("#btn_49_741014").on("click",function(){h()})}).show()):c.accountType&&"103,104,107".indexOf(c.accountType)>-1?(Common.isDebitCard=!1,t=2,$("#sec_container").empty().hide(),$("#cardLogin_ul").prev().hide(),$("#cardLogin_ul").html(s.creditCardLogin,function(){CU.changeLan($("#cardLogin_ul")),Common.LightBox.hide(),$("#txt_50514_740882").on("blur",function(){/^[0-9]*$/.test($(this).val())||15==$(this).val().length&&16==$(this).val().length&&19==$(this).val().length?!/^[0-9]*$/.test($(this).val())||19!=$(this).val().length&&15==$(this).val().length&&16==$(this).val().length||(v=!0,g($(this))):($("#cardLogin_ul").hide(),$("#cardLogin_ul").prev().show(),$("#txt_username_79443").val($(this).val()))}),$("#txt_50514_740882").val(b),$("#txt_50531_740884").sec({mode:3,RandomKey_S:r}),$("#txt_50531_740884").sec("Version")||($("#sec_container").hide(),$("#sec_required").show()),$("#captcha_creditCard").attr("src",validationURL+(new Date).getTime()+".gif"),$("#txt_captcha_740885").val($.browser.msie?CU.getDictNameByKey($("#txt_captcha_740885").attr("phLan")):""),$("#a_shuaxin_740886,#captcha_creditCard").on("click",function(a){stopBubble(a||window.event),setTimeout(function(){$("#captcha_creditCard").attr("src",validationURL+(new Date).getTime()+".gif")},1)}),$("#btn_49_740887").on("click",function(){h()})}).show()):(Common.LightBox.show(),$(document.body).append(s.misMatchAcct,function(){var a=$("#misMatchAcctPop");CU.setObjAbsCenter(a),a.find("a.close,#btn_ok_740747").on("click",function(){a.remove(),Common.LightBox.hide()})}))}else u=!1,v=!1}))}function h(){if(formValid.checkAll(document.body)){var a={loginName:Common.isDebitCard?$("#txt_50514_741010").val():$("#txt_50514_740882").val(),validationChar:Common.isDebitCard?$("#txt_captcha_741012").val():$("#txt_captcha_740885").val(),activ:Common.isDebitCard?$("#div_password_79445_1").sec("Version"):$("#txt_50531_740884").sec("Version"),state:Common.isDebitCard?$("#div_password_79445_1").sec("State"):$("#txt_50531_740884").sec("State")};Common.isDebitCard?(a.atmPassword=$("#div_password_79445_1").sec("Value"),a.atmPassword_RC=$("#div_password_79445_1").sec("RandomKey_C")):(a.phoneBankPassword=$("#txt_50531_740884").sec("Value"),a.phoneBankPassword_RC=$("#txt_50531_740884").sec("RandomKey_C")),Common.LightBox.show(),Common.postRequest(new Model("PsnAccBocnetLogin",a,q)).then(function(a){var b=CU.ajaxDataHandle(a);CU.isSuccesful(a)&&b.accountSeq?(Common.LightBox.hide(),window.top.location.href=o.electron+"?v="+window.VERSION+"&locale="+dojo.locale+"&login=card&segment="+segment):(Common.LightBox.hide(),$("#div_password_79445_1").sec("Clear"),$("#txt_50531_740884").sec("Clear"),d())})}}var i,j,k,l,m={},n={},o={normal:"welcome.html",vip:"welcome_vip.html",electron:"welcome_ele.html"},p=0;Common.LOGIN_PRE=!0,Common.isDebitCard=!1;var q,r,s={debitCardLogin:"templates/login/debitCardLogin.ejs",creditCardLogin:"templates/login/creditCardLogin.ejs",misMatchAcct:"templates/login/misMatchAccount.ejs"},t=0,u=!0,v=!1;$("#txt_username_79443").on("blur",function(){var a=$(this).val().length;!/^[0-9]*$/.test($(this).val())||15!=a&&16!=a&&19!=a||(q||r?g($(this)):f())}),m.cardLogin=function(a,b){Common.LightBox.show(),Common.postRequest(new Model("PsnAccBocnetLogin",a,b)).then(function(a){CU.ajaxDataHandle(a),CU.isSuccesful(a)?(Common.LightBox.hide(),window.top.location.href=o.electron+"?v="+window.VERSION+"&locale="+dojo.locale+"&login=card&segment="+segment):Common.LightBox.hide()})},$("#btn_login_79676").on("click",function(a){function f(a,b,c,d){var e=$("#container"),f=d?"append":"html";e[f](a,b,function(){CU.changeLan(e),c()})}function g(a,b){a&&b&&Common.postRequest(new Model("PSNGetTokenId",a)).then(function(a){var c=CU.ajaxDataHandle(a);b&&CU.isSuccesful(a)&&b(c)})}function h(a){$("#captcha-item").show(),a||$("#div_password_79445").sec("Clear"),l=!0,k=!1}function m(a){var b=$("#div_password_79445");l&&(a={validationChar:O}),Common.postRequest(new Model("LoginPre",$.extend({loginName:N,activ:b.sec("Version"),state:b.sec("State"),password:b.sec("Value"),password_RC:b.sec("RandomKey_C"),segment:segment,devicePrint:encode_deviceprint()},a),i)).then(n)}function n(a){var b,c=CU.ajaxDataHandle(a);if(CU.isSuccesful(a)){if(1==c.needValidationChars)return void h(!0);b=new Common.AC({loginPre:!0,isLogin:!0,el:$(document.body),data:c,conversationId:i,random:j,ok:function(a){Common.postRequest(new Model("LoginForTM",$.extend({isusualdevice:"1"},b.get()),i)).then(function(c){b.ajaxDataHandle(c),CU.isSuccesful(c)?(b.hide(),r(c)):(d(),h()),a()})}}),"ALLOW"==b.result&&q()}else 5>p&&"conversationMap.null"===a.response[0].error.code?(p+=1,e(!0)):d(),h()}function q(a){Common.postRequest(new Model("LoginForTM",$.extend({devicePrint:encode_deviceprint(),loginName:N},a),i)).then(r)}function r(a){K=CU.ajaxDataHandle(a),CU.isSuccesful(a)?Common.postRequest(new Model("PsnCommonQueryOprLoginInfo")).then(function(a){return L=CU.ajaxDataHandle(a),66!=L.segmentId&&66==segment?void Common.LightBox.showMessage(CU.getDictNameByKey("l32656")):void s()}):(d(),h())}function s(){switch(K.regtype){case"1":t();break;case"3":u()}}function t(){switch(K.combinStatus){case"11":v();break;case"10":w();break;default:x()}}function u(){f(M.EJS_BATCH,null,function(){$("#btn_accept_agreement_15187").on("click",function(a){stopBubble(a||window.event),$(this).off("click"),t()})})}function v(){f(M.EJS_COMBINE,L,function(){$("#btn_continue_28937").on("click",function(a){stopBubble(a||window.event),y()}),$("#btn_download_28938").attr("href",M.FILE_COMBINE[lan])},null,CU.getDictNameByKey("l8987"))}function w(){Common.postRequest(new Model("PsnCustomerCombinInfo")).then(function(a){var b=CU.ajaxDataHandle(a);CU.isSuccesful(a)&&Common.postRequest(new Model("Logout")).then(function(a){CU.ajaxDataHandle(a),CU.isSuccesful(a)&&f(M.EJS_INFO,b,function(){$("#btn_boc_website_15147").attr("href",M.BOC_WEBSITE),$("#div_username_15144").text(N)})})})}function x(){switch(K.loginStatus){case"0":z();break;case"1":A();break;case"2":D()}}function y(){Common.postRequest(new Model("AgreeCombin")).then(function(a){CU.isSuccesful(a)&&($("#btn_continue_28937,#btn_download_28938").off("click"),x())})}function z(){switch(K.userStatus){case"VERIFIED":case"":J();break;case"UNVERIFIED":case"NOTENROLLED":10==L.segmentId?J():G()}}function A(){function a(a,b){var c=CU.ajaxDataHandle(a);$("#psw_enter_old_password_15689").sec({mode:10,RandomKey_S:c}),$("#psw_enter_new_password_15691,#psw_repeat_new_password_15693").sec({mode:11,RandomKey_S:c}),$("input[name=rd_choose_security_tool_17637]").on("change",function(){var a=$(this).val();"32"==a&&P.isSMSActivated(b)}),$("#btn_ok_15695").on("click",function(a){if(stopBubble(a||window.event),formValid.checkAll("#container")){var c=L.defaultSafety;if(!c||c.length<1){var d=$("input[name=rd_choose_security_tool_17637][type=radio]:checked").val();if(d)c=d;else{if(10!=L.segmentId)return void Common.LightBox.showMessage(CU.getDictNameByKey("l0325"));c="0"}}B(b,c)}}),$("#btn_reset_15696").on("click",function(a){return stopBubble(a||window.event),$("#login_name_unique").removeAttr("lan").text(""),CU.resetForm($("#container")),!1}),$("#btn_check_existence_15694").on("click",function(a){stopBubble(a||window.event),Common.postRequest(new Model("LoginNameUniqueCheck",{loginName:$("#txt_enter_new_username_new").val(),channel:"1"})).then(function(a){var b=CU.ajaxDataHandle(a);CU.isSuccesful(a)&&(b+""=="true"?$("#login_name_unique").addClass("text-red").removeClass("text-green").attr("lan","l8982").text(CU.getDictNameByKey("l8982")):$("#login_name_unique").addClass("text-green").removeClass("text-red").attr("lan","l8983").text(CU.getDictNameByKey("l8983")))})})}function c(){b(function(b){Common.postRequest(new Model("PSNGetRandom",b)).then(function(c){a(c,b)})})}L.defaultSafety&&L.defaultSafety.length>0||10==L.segmentId?f(M.EJS_SET_ACT,{userInfo:L},c,null,CU.getDictNameByKey("l1375")):Common.postRequest(new Model("PsnSVRSecurityList")).then(function(a){var b=CU.ajaxDataHandle(a);b&&b.length>0&&f(M.EJS_SET_ACT,{userInfo:L,secuList:b},c,null,CU.getDictNameByKey("l1375"))})}function B(a,b){var c=$("#psw_enter_old_password_15689"),d=$("#psw_enter_new_password_15691"),e=$("#psw_repeat_new_password_15693");Common.postRequest(new Model("NamePasswordMod",{loginName:$("#txt_enter_new_username_new").val(),activ:c.sec("Version"),state:c.sec("State"),oldPass:c.sec("Value"),oldPass_RC:c.sec("RandomKey_C"),newPass:d.sec("Value"),newPass_RC:d.sec("RandomKey_C"),newPass2:e.sec("Value"),newPass2_RC:e.sec("RandomKey_C"),combinId:b},a)).then(function(b){CU.ajaxDataHandle(b),CU.isSuccesful(b)&&($("#btn_ok_15695,#btn_reset_15696,#btn_check_existence_15694").off("click"),C(a))})}function C(a){f(M.EJS_DONE_ACT,null,function(){$("#btn_continue_15841").on("click",function(b){stopBubble(b||window.event),$(this).off("click"),c(a),z()})},null,CU.getDictNameByKey("l1375"))}function D(){function a(a,b){var c=CU.ajaxDataHandle(a);$("#psw_enter_old_password_15881").sec({mode:10,RandomKey_S:c}),$("#psw_enter_new_password_15885,#psw_repeat_new_password_15887").sec({mode:11,RandomKey_S:c}),$("#btn_ok_15890").on("click",function(a){stopBubble(a||window.event),formValid.checkAll("#container")&&g(b,function(a){E(b,a)})}),$("#btn_reset_15886").on("click",function(a){stopBubble(a||window.event),CU.resetForm($("#container"))})}f(M.EJS_SET_PWD,L,function(){b(function(b){Common.postRequest(new Model("PSNGetRandom",b)).then(function(c){a(c,b)})})})}function E(a,b){var c=$("#psw_enter_old_password_15881"),d=$("#psw_enter_new_password_15885"),e=$("#psw_repeat_new_password_15887");Common.postRequest(new Model("PsnSVRPasswordSeting",{activ:c.sec("Version"),state:c.sec("State"),oldPass:c.sec("Value"),oldPass_RC:c.sec("RandomKey_C"),newPass:d.sec("Value"),newPass_RC:d.sec("RandomKey_C"),newPass2:e.sec("Value"),newPass2_RC:e.sec("RandomKey_C"),token:b},a)).then(function(b){CU.ajaxDataHandle(b),CU.isSuccesful(b)&&($("#btn_ok_15890,#btn_reset_15886").off("click"),F(a))})}function F(a){f(M.EJS_DONE_PWD,null,function(){$("#btn_continue_15933").on("click",function(b){stopBubble(b||window.event),$(this).off("click"),c(a),z()})},null,CU.getDictNameByKey("l1447"))}function G(){var a=K.challengeQuestion;return $("#securityQuestionSetting").size()>0?($("#securityQuestionSetting").show(),void $("#securityQuestionConfirm").hide()):void f(M.EJS_QUES_SET,{},function(){1==K.loginStatus?$("#btn_skip_17641").show():$("#btn_skip_17641").hide(),$("#question-intro").height($("#question-box").height()-14+"px"),Common.SF.showSelector("PB102C",function(){CU.changeLan($("#securityQuestionSetting"));var b,c=[$("#sel_question_one_17624"),$("#sel_question_two_17628"),$("#sel_question_three_17632")];b=$.map(a,function(a,b){return new ITSelect({data:$.map(a,function(a){return{key:a.questionId,val:a.questionText}}),defText:"<span lan='l0092'>"+CU.getDictNameByKey("l0092")+"</span>",appendTo:c[b]})}),$("#btn_nextstep_17639").on("click",function(a){if(stopBubble(a||window.event),formValid.checkAll("#container")&&Common.SF.check()){var c=[$("#txt_answer_one_17626").val(),$("#txt_answer_two_17630").val(),$("#txt_answer_three_17634").val()];Common.postRequest(new Model("PsnLoginChallengeQASettingVerify",{questionOne:b[0].txt,questionOneId:b[0].val,answerOne:c[0],questionTwo:b[1].txt,questionTwoId:b[1].val,answerTwo:c[1],questionThree:b[1].txt,questionThreeId:b[1].val,answerThree:c[1],isusualdevice:"0",_combinId:Common.SF.get("combinId")},Common.SF.get("conversationId"))).then(function(a){var d=CU.ajaxDataHandle(a);CU.isSuccesful(a)&&H(b,c,d)})}}),$("#btn_reset_17640").on("click",function(a){return stopBubble(a||window.event),CU.resetForm($("#container")),!1}),$("#btn_skip_17641").on("click",function(a){stopBubble(a||window.event),$("#btn_nextstep_17639,#btn_reset_17640,#btn_skip_17641").off("click"),J()})})},!1,CU.getDictNameByKey("l15630"))}function H(a,b,c){return $("#securityQuestionConfirm").size()>0?($("#securityQuestionConfirm").show(),$("#securityQuestionSetting").hide(),$("#div_question_one_18043").text(a[0].txt),$("#div_question_two_18047").text(a[1].txt),$("#div_question_three_18051").text(a[2].txt),$("#div_answer_one_18045").text(b[0]),$("#div_answer_two_18049").text(b[1]),$("#div_answer_three_18053").text(b[2]),$("#btn_confirm_18061").off("click"),void Common.SF.appendInputTo("#qa_list",function(){CU.changeLan($("#qa_list")),$("#qa_list").attr("isShowSF","true"),$("#btn_confirm_18061").on("click",function(c){stopBubble(c||window.event),formValid.checkAll("#qa_list")&&g(Common.SF.get("conversationId"),function(d){var e=Common.SF.get("Smc"),f=Common.SF.get("Otp"),g=Common.SF.get("signedData"),h={questionOne:a[0].txt,questionOneId:a[0].val,answerOne:b[0],questionTwo:a[1].txt,questionTwoId:a[1].val,answerTwo:b[1],questionThree:a[1].txt,questionThreeId:a[1].val,answerThree:b[1],userStatus:K.userStatus,token:d,devicePrint:encode_deviceprint()};if(e&&$.extend(h,{activ:e.Version,state:e.State,Smc:e.Value,Smc_RC:e.RandomKey_C}),f&&$.extend(h,{activ:f.Version,state:f.State,Otp:f.Value,Otp_RC:f.RandomKey_C}),g){if(!g.result)return!1;$.extend(h,{_signedData:g.result})}Common.postRequest(new Model("PsnLoginChallengeQASetting",h,Common.SF.get("conversationId"))).then(function(d){CU.ajaxDataHandle(d),CU.isSuccesful(d)?(I(a,b),$("#btn_nextstep_17639,#btn_reset_17640,#btn_skip_17641,#btn_confirm_18061,#btn_forward_18062").off("click")):(stopBubble(c||window.event),Common.SF.clear(),Common.LightBox.hide())})})})},c)):void f(M.EJS_QUES_CFM,{},function(){$("#btn_forward_18062").on("click",function(a){stopBubble(a||window.event),G()}),H(a,b,c)},!0,CU.getDictNameByKey("l1726"))}function I(a,b){f(M.EJS_QUES_DONE,{q1:a[0].txt,q2:a[1].txt,q3:a[2].txt,a1:b[0],a2:b[1],a3:b[2]},function(){$("#btn_confirm_18969").on("click",function(a){stopBubble(a||window.event),$(this).off("click"),c(Common.SF.get("conversationId")),J()})},!1,CU.getDictNameByKey("l1802"))}function J(){var a;a=66==L.segmentId?o.vip:o.normal,window.top.location.href=a+"?v="+window.VERSION+"&locale="+dojo.locale}if(!k){var K,L,M={BOC_WEBSITE:"login.html",EJS_BATCH:"templates/login/batchServiceAgreement.ejs",EJS_INFO:"templates/login/combineInfo.ejs",EJS_COMBINE:"templates/login/combineAgreement.ejs",EJS_SET_ACT:"templates/login/forceResetAccount.ejs",EJS_DONE_ACT:"templates/login/forceResetAccountSuccess.ejs",EJS_SET_PWD:"templates/login/forceResetPassword.ejs",EJS_DONE_PWD:"templates/login/forceResetPasswordSuccess.ejs",EJS_QUES_SET:"templates/login/securityQuestionSetting.ejs",EJS_QUES_CFM:"templates/login/securityQuestionConfirm.ejs",EJS_QUES_DONE:"templates/login/securityQuestionSuccess.ejs",EJS_SMS_ACTIVATE_PATHS:{activateTips:"templates/personalPerenference/securityFactorSet/activateTips.ejs",activateSuccess:"templates/personalPerenference/securityFactorSet/activateSuccess.ejs",confirmActivate:"templates/personalPerenference/securityFactorSet/confirmActivate.ejs",confirmVerifyInfo:"templates/personalPerenference/securityFactorSet/confirmVerifyInfo.ejs"},FILE_COMBINE:{C:"download/Notice on E-banking Customer Information Merge of Bank of China_zh_CN.pdf",E:"download/Notice on E-banking Customer Information Merge of Bank of China.pdf",J:"download/Notice on E-banking Customer Information Merge of Bank of China.pdf",K:"download/Notice on E-banking Customer Information Merge of Bank of China.pdf"}},N=$("#txt_username_79443").val(),O=$("#txt_captcha_79449").val();if(stopBubble(a||window.event),formValid.checkAll(document.body)){k=!0,m();var P={isSMSActivated:function(a){var b=this;Common.postRequest(new Model("PsnSvrQueryMessage",{},a)).then(function(a){var c=CU.ajaxDataHandle(a);b._phoneNumberTemp=c.phoneNumber,c.flag||c.flag||(Common.LightBox.show(),f(M.EJS_SMS_ACTIVATE_PATHS.activateTips,{},function(){var a=$(document.body).find("#SMSNotActivatedPopup");$(document.body).find("#btn_631_68521, a.close").on("click",function(){a.remove(),Common.LightBox.hide()}),$(document.body).find("#btn_630_68520").on("click",function(){a.remove(),Common.LightBox.hide(),b.confirmActivate()}),CU.changeLan(a),CU.setObjAbsCenter(a)},!0))})},confirmActivate:function(){var a=this,c={};c.phoneNumber=Common.Security.mask("",a._phoneNumberTemp),Common.LightBox.show(),f(M.EJS_SMS_ACTIVATE_PATHS.confirmActivate,c,function(){b(function(b){if(a._conversationId=b,a._conversationId){var c=$(document.body).find("#confirmActivate");Common.SF.showSelector("PB104C",function(){CU.changeLan($(document.body).find("#safeTool_Div")),$(document.body).find("#btn_confirm_68788").on("click",function(){if(!Common.SF.check())return!1;var b={_combinId:Common.SF.get("combinId"),phoneNumber:a._phoneNumberTemp};Common.postRequest(new Model("SignMessageServicePre",b,a._conversationId)).then(function(b){var d=CU.ajaxDataHandle(b);d.phoneNumber=a._phoneNumberTemp,c.remove(),a.confirmVerifyInfo(d,a._conversationId)})})},"#safeTool_Div",a._conversationId),CU.changeLan(c),CU.setObjAbsCenter(c)}})},!0)},confirmVerifyInfo:function(a,b){var c=this;a.phoneNumber=Common.Security.mask("",c._phoneNumberTemp),f(M.EJS_SMS_ACTIVATE_PATHS.confirmVerifyInfo,a,function(){var d=$(document.body).find("#confirmVerifyInfo");Common.SF.appendInputTo("#sf-ul",function(){CU.changeLan($(document.body).find("#confirmVerifyInfo")),Common.postRequest(new Model("PSNGetTokenId",null,b)).then(function(a){c._token=CU.ajaxDataHandle(a)}),$(document.body).find("#btn_confirm_69543").on("click",function(){if(!formValid.checkAll($("#confirmVerifyInfo")))return!1;if(!Common.SF.check())return!1;var a={toActiveAct:c.toActiveAct,token:c._token,phoneNumber:c._phoneNumberTemp},e=Common.SF.get("Smc"),g=Common.SF.get("Otp");Common.AC.enabled&&(a.devicePrint=encode_deviceprint()),e&&$.extend(a,{activ:e.Version,state:e.State,Smc:e.Value,Smc_RC:e.RandomKey_C}),g&&$.extend(a,{activ:g.Version,state:g.State,Otp:g.Value,Otp_RC:g.RandomKey_C});var h=Common.SF.get("signedData");if(h){if(!h.result)return!1;a._signedData=h.result}Common.LightBox.show(),Common.postRequest(new Model("SignMessageService",a,b)).then(function(a){CU.isSuccesful(a)&&(d.remove(),Common.LightBox.hide(),f(M.EJS_SMS_ACTIVATE_PATHS.activateSuccess,{},function(){var a=$(document.body).find("#activateSuccess");$("#btn_confirm_69821").on("click",function(){a.remove(),Common.LightBox.hide()}),CU.changeLan(a),CU.setObjAbsCenter(a)},!0))})}),$("#btn_reset_69544").on("click",function(a){stopBubble(a||window.event),Common.SF.clear()})},a),CU.changeLan(d),CU.setObjAbsCenter(d)},!0)}}}}}),$("#a_11_79447,#captcha").on("click",function(a){stopBubble(a||window.event),setTimeout(function(){$("#captcha").attr("src",validationURL+(new Date).getTime()+".gif")},1)}),$.browser.msie?$("#txt_captcha_79449").on("focus",function(){$(this).removeClass("inputfm")}).on("blur",function(){var a=$.trim($(this).val());(""===a||a===CU.getDictNameByKey("l7143"))&&$(this).addClass("inputfm")}):$("#txt_captcha_79449").removeClass("inputfm"),$("#txt_captcha_79449").on("keydown",function(a){a=window.event||a;var b=a.keyCode||a.which;13===b&&$("#btn_login_79676").trigger("click")}),$("#a_58_1167").attr({href:"help.html?locale="+localParam[lan]+"&menu=Login",target:"_blank"}),$("a[href][target=_blank]").on("click",function(a){a=window.event||a;try{a.preventDefault()}catch(b){}stopBubble(a);var c,d="";("a_60_1170"===this.id||"a_60_1169"===this.id)&&(d=",width=810,height=645",c=[Math.floor((screen.width-810)/2),Math.floor((screen.height-645)/2)]);var e=window.open($(this).attr("href"),"extWin","toolbar=no, menubar=no,scrollbars=yes, location=no, status=no,resizable=yes"+d);return c&&setTimeout(function(){try{e.moveTo(c[0],c[1])}catch(a){}},0),!1}),m.show=function(a){a||(a={}),$("#wrapper").show(),$("#iframe").hide(),$("#div_password_79445").sec("Clear"),$("#div_password_79445_1").sec("Clear"),$("#txt_50531_740884").sec("Clear"),d(),$("#txt_username_79443").val(a.username||"")},m.changeLan=function(a,b){dojo.locale=a,0===a.indexOf("en")?(lan="E",$("#lan-en").hide(),$("#lan-zh").show(),$(document.body).addClass("i18n_en")):(lan="C",$("#lan-en").show(),$("#lan-zh").hide(),$(document.body).removeClass("i18n_en")),$("#a_58_1167").attr("href","help.html?locale="+localParam[lan]+"&menu=Login"),CU.changeLan(),$.browser.msie&&$("#txt_captcha_79449").val(CU.getDictNameByKey($("#txt_captcha_79449").attr("phLan"))),b&&$("#iframe").attr("src")&&(n.url="/boc20/login/login.html?locale="+a+"&seg="+segment+"&username="+$("#txt_username_79443").val())},m.hideLoading=function(){$("#ajaxLoading").hide(),$("#wrapper").hide(),$("#iframe").show(),$.browser.mozilla&&$("#iframe").css("visibility","visible"),Common.LightBox.hide()},n.show=function(a){if($.browser.msie&&($.browser.version<7&&!a||$.browser.version>10)){if($.browser.version>10)return"C"===lan&&($("#msgBox").css("width","540px"),$("#msgBox .bu-pop").css("width","540px")),Common.LightBox.showMessage(CU.getDictNameByKey("l29630"));if($.browser.version<7)return $("#msgBox").css("width","470px"),$("#msgBox .bu-pop").css("width","470px"),$("#hideMsgBox,#closeMsgBox").on("click.restrict",function(){$("#hideMsgBox,#closeMsgBox").off("click.restrict"),$("#msgBox").css("width","590px"),$("#msgBox .bu-pop").css("width","590px")}),Common.LightBox.showMessage(CU.getDictNameByKey("l29718"))}if(!$("#iframe").attr("src")||n.url)$("#_ajaxLoading").attr("id","ajaxLoading"),$.browser.mozilla&&$("#iframe").css("visibility","hidden").show(),Common.LightBox.show(),$("#ajaxLoading").show(),n.url?($("#iframe").attr("src",n.url+(a?"&init="+a:"")),n.url=null):$("#iframe").attr("src","/boc20/login/login.html?locale="+dojo.locale+"&seg="+segment+"&username="+$("#txt_username_79443").val()+(a?"&init="+a:""));else{var b=$("#iframe").get(0).contentWindow;$("#wrapper").hide();try{$(b.document).find("input[name=j_username]").val($("#txt_username_79443").val()),b.login.loginWidget.refreshValidateImg()}catch(c){}if($("#iframe").show(),a)try{b.login.formUE15=!0,b.login.loginWidget[a]()}catch(c){}}},$("#i-style").on("click",function(){n.show()}),$("a[init]").on("click",function(){n.show($(this).attr("init"))}),$.browser.msie&&$.browser.version<=10||$.browser.chrome||$.browser.firefox||dojo.isSafari&&dojo.isMac||$.browser.mozilla&&5==$.browser.version?a(function(){window.lanLoaded={C:!0,E:!0},CU.changeLan($("body")),e()}):$.browser.msie&&$.browser.version>10?($("#hideMsgBox,#closeMsgBox").on("click",function(){window.close()}),$("#ajaxLoading").hide(),n.show()):n.show(),$("#lan-en").on("click",function(){m.changeLan("en",!0)}),$("#lan-zh").on("click",function(){m.changeLan("zh",!0)}),window.BOC15=m;var w=window.location.search,x=new RegExp("init=([^&?]*)","ig"),y=w.match(x)?w.match(x)[0].substr("init".length+1):null;y&&n.show(y)});